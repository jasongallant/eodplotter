---
title: "EODPlotter manual"
author: "Colin Diesh"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


# EODPlotter User Manual

## Source Code

https://github.com/msuefishlab/eodplotter

## Installation

EODPlotter is designed as an R package, to be installed using a package
manager. EODPlotter is a command line alternative to the [TDMSViewer](https://github.com/msuefishlab/tdmsviewer)

We will install EODPlotter from github. Open RStudio and run

```{r,eval=F}
install.packages('devtools')
```

This will install the devtools package which has the `install_github` function. Then run

```{r,eval=F}
devtools::install_github('msuefishlab/eodplotter')
```

After running this it should install the EODViewer code and its
dependencies automatically. 

To install a specific version, e.g. the version mentioned in this guide, you
can also run

```{r,eval=F}
install_github('msuefishlab/eodplotter@0.0.3')
```

#### Important for command line usage

Also add this to your .bash_profile to add the Rscripts to your command line path:

```
export PATH=$PATH:`Rscript -e 'cat(paste0(.libPaths(),"/eodplotter/scripts",collapse=":"))'`:~/bin
```



## Using EODPlotter as a command line tool

### Process a TDMS file


```
# plots the raw signal as a graph, use to diagnose signal problems
tdmsplot -f file.tdms
# finds all EODs and outputs a new file, e.g. file.peaks.csv, which is named based on the input file (if you analyzed fish.tdms, it would output fish.peaks.csv)
peak_finder -f file.tdms -v
# analyze the signal and the peaks to produce output files
eodplot -f file.tdms -p file.peaks.csv
```


### Reference

#### `tdmsplot`

```
tdmsplot
Usage: /Users/cdiesh/src/github.com/msuefishlab/eodplotter/inst/scripts/tdmsplot [options]


Options:
    -h, --help
        Show this help message and exit

    -f FILE, --file=FILE
        TDMS file input

    -v VERBOSE, --verbose=VERBOSE
        Print verbose output

    -c CHANNEL, --channel=CHANNEL
        Channel name

    -s START, --start=START
        Start time

    -e END, --end=END
        End time
```

Outputs a file.signal.png file representing the raw signal values of the EODs

#### `peak_finder`

```
Usage: /Users/cdiesh/src/github.com/msuefishlab/eodplotter/inst/scripts/peak_finder [options]

## Using EODPlotter as an R library




Load the library

```{r}
library(eodplotter)
```


Plot the raw signal of the data using plotTdms

```{r}
plotTdms('../tests/testthat/file.tdms')
```

Find peaks

```{r}
p = peakFinder('../tests/testthat/file.tdms')
print(head(p))
```

Get a matrix of EOD signal

```{r}
m = getEODMatrix('../tests/testthat/file.tdms', p, prebaseline=T)
print(head(m))
```

Plot the matrix of EOD signals

```{r}
plotAverage(m)
```



Plot all the signals

```{r}
plotTotal(m)
```



Plot the matrix of EOD signals

```{r}
landmarks = findLandmarks(m)
print(landmarks)
```


Plot the landmarks

```{r}
plotLandmarks(m, landmarks)
```


Get stats about the landmarks

```{r}
getStats(p, landmarks)
```


## Conclusion


This demo shows you how to use the `eodplotter` as an R library. Note that there is the alternative usage of the library using the command line as well, which can be more streamlined
